# prometheus-s3-exporter

Prometheus S3 Exporter - это сервис на Python, который собирает метрики о состоянии S3-совместимого хранилища и экспортирует их в формате, пригодном для сбора Prometheus. Сервис предоставляет эндпоинт /metrics с актуальными метриками о вашем S3-хранилище.

# Возможности
- Сбор метрик о S3-бакетах (размер, количество объектов)
- Гибкая конфигурация через переменные окружения
- Готовность к развертыванию в Kubernetes
- Поддержка GitOps-деплоя через ArgoCD


# Установка и запуск

### Локальный запуск
1. Клонируйте репозиторий `git clone https://github.com/ArgArakelyan/prometheus-s3-exporter.git`
2. Настройте `docker-compose.yml` с нужными переменными оркжуения (они описаны ниже)
3. Запустите сервис `docker compose up -d`

### Деплой в Kubernetes через ArgoCD
Манифесты для деплоя через ArgoCD находятся в папке argocd-deploy.

1. Убедитесь, что ArgoCD установлен в вашем кластере
2. Заранее создайте нужные секреты в неймспейсе, куда будет деплоится сам сервис
2. Создайте новое приложение в ArgoCD, указав:
   - URL репозитория, и directory `argocd-deploy`

# Конфигурация

### Переменные окружения
- `AWS_ACCESS_KEY_ID` - ключ доступа S3
- `AWS_ACCESS_SECRET_KEY` - секретный ключ S3
- `S3_ENDPOINT` - URL эндпоинта S3 хранилища
- `REGION_NAME` - регион в котором доступно ваше хранилище

### Экспортируемые метрики
- `s3_bucket_size_bytes` - Размер бакета в байтах
- `s3_object_count` - Количество объектов в бакете
- `s3_bucket_last_modified_timestamp_seconds` - Время изменения последнего объекта
  - используется для отслеживания активности записи в бакет
- `s3_bucket_oldest_object_timestamp_seconds` - Время самого последнего объекта в бакете
  - используется для отслеживания политик ротации
